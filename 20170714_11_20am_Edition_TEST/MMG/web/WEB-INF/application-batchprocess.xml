
<beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:task="http://www.springframework.org/schema/task"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:batch="http://www.springframework.org/schema/batch"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
       http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
       http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-2.0.xsd">



     <!--  JOB REPOSITORY - WE USE IN-MEMORY REPOSITORY FOR OUR EXAMPLE -->
    <beans:bean id="jobRepository"
           class="org.springframework.batch.core.repository.support.MapJobRepositoryFactoryBean">
        <beans:property name="transactionManager" ref="transactionManager" />
    </beans:bean>
    
      <!--  LAUNCH JOBS FROM A REPOSITORY -->
    <beans:bean id="jobLauncher"
           class="org.springframework.batch.core.launch.support.SimpleJobLauncher">
        <beans:property name="jobRepository" ref="jobRepository" />
        <beans:property name="taskExecutor">
            <beans:bean class="org.springframework.core.task.SimpleAsyncTaskExecutor" />
        </beans:property>
     
    </beans:bean>

    <!-- Defining the CHUNK Job -->
    <batch:job id="batchChunkJob" >
        <batch:step id="chunkstep_1">
            <batch:tasklet>
                <batch:chunk reader="ueersChunkReader" writer="usersChunkWriter" commit-interval="1" />
            </batch:tasklet>
        </batch:step>
    </batch:job>


    <beans:bean id="ueersChunkReader" class="com.mazdausa.mmg.batch.reader.UsersChunkReader">
        <beans:property name="currentIndex" value="0"/>
    </beans:bean>

    <beans:bean id="usersChunkWriter" class="com.mazdausa.mmg.batch.writer.UsersChunkWriter">
    </beans:bean>


            <!-- Definition of the SCHEDULE for the Batch Process -->
    <beans:bean id="batchProcessScheduler" class="com.mazdausa.mmg.batch.scheduler.BatchProcessScheduler"/>

     <!-- Defining the list of Scheduled Tasks 
    <task:scheduled-tasks>
        <task:scheduled ref="batchProcessScheduler" method="startBatchProcess" cron="*${IPHONE_PUSH_NOTIFICATION_SCHEDULER_CRON_EXPRESSION}"/>
    </task:scheduled-tasks>-->

     <beans:bean id="batchProcessTimer" class="org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean">
        <beans:property name="targetObject" ref="batchProcessScheduler"/>
        <beans:property name="targetMethod" value="startBatchProcess"/>
    </beans:bean>

    <beans:bean id="batchCronTrigger" class="org.springframework.scheduling.quartz.CronTriggerBean">
        <beans:property name="jobDetail" ref="batchProcessTimer"/>
        <!-- <property name="cronExpression" value="0 0/2 * * * ?"/>  -->
        <beans:property name="cronExpression" value="${IPHONE_PUSH_NOTIFICATION_SCHEDULER_CRON_EXPRESSION}"/>
    </beans:bean>

   <!-- Specifying the list of timers that are being used in the Current Application -->
    <beans:bean id="quartzSimpleBean" class="org.springframework.scheduling.quartz.SchedulerFactoryBean">
        <beans:property name="triggers">
            <beans:list>
              <!-- <ref bean="applicationCronTrigger"/> -->
                <beans:ref bean="batchCronTrigger"/>
            </beans:list>
        </beans:property>
    </beans:bean>


</beans:beans>